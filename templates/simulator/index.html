{% extends "base.html" %}

{% block title %}Simulator - Turing Machine{% endblock %}

{% block content %}
<div class="simulator-page">
    <div class="simulator-container">
        <!-- Tape Section -->
        <section class="tape-section">
            <h2>The Tape</h2>
            <div class="tape-input-row">
                <label>Your number:</label>
                <input type="text" id="tape-input" placeholder="e.g., 1011">
                <button id="btn-set-tape" class="btn-small btn-secondary">Change</button>
            </div>
            <div class="tape-wrapper">
                <div class="tape" id="tape">
                    <!-- Tape cells render here -->
                </div>
                <div class="head-indicator">HEAD</div>
            </div>
            <div class="state-display">
                <span class="state-emoji" id="state-emoji"></span>
                <span class="state-label">Mode: <strong id="current-state">-</strong></span>
                <span class="state-description" id="state-description"></span>
                <span id="status-badge" class="status-badge"></span>
            </div>
        </section>

        <!-- NEXT ACTION: What WILL happen (shown BEFORE the action) -->
        <section class="next-action-section">
            <h2>Next Action</h2>
            <div class="next-action-box" id="next-action-box">
                <div class="next-action-situation">
                    <span>I'm in <strong id="next-state">SCAN</strong> mode and I see: <strong id="next-symbol">1</strong></span>
                </div>
                <div class="next-action-will-do">
                    <p id="next-action-text">Keep the 1, move RIGHT, stay in SCAN</p>
                </div>
                <div class="next-action-why">
                    <p id="next-action-why">I'm still looking for the end of the number.</p>
                </div>
            </div>
            <div class="goal-display" id="goal-display">
                <!-- Goal info shows here -->
            </div>
        </section>

        <!-- Controls -->
        <div class="controls">
            <button id="btn-step" class="btn-primary">Do This Step</button>
            <button id="btn-run" class="btn-success">Run All</button>
            <button id="btn-pause" class="btn-warning" disabled>Pause</button>
            <button id="btn-reset" class="btn-danger">Start Over</button>
            <div class="speed-control">
                <label>Speed:</label>
                <input type="range" id="speed-slider" min="1" max="100" value="50">
            </div>
        </div>

        <!-- State Graph Section -->
        <section class="state-graph-section">
            <h2>State Machine</h2>
            <div class="state-graph-container" id="simulator-graph">
                <!-- State graph renders here -->
            </div>
        </section>

        <!-- Rules Section -->
        <section class="rules-section">
            <div class="rules-header">
                <h2>The Rules</h2>
            </div>
            <div class="rules-groups">
                <div class="rules-group" id="rules-scan">
                    <h3><span class="state-emoji-small">üîç</span> SCAN MODE</h3>
                    <div class="rules-list" id="rules-list-scan"></div>
                </div>
                <div class="rules-group" id="rules-add">
                    <h3><span class="state-emoji-small">‚ûï</span> ADD MODE</h3>
                    <div class="rules-list" id="rules-list-add"></div>
                </div>
            </div>
        </section>

        <!-- History Log -->
        <section class="history-section">
            <h2>What Happened</h2>
            <div class="history-log" id="history-log">
                <!-- History entries render here -->
            </div>
        </section>

        <!-- Challenge Mode Button (shows after completing example) -->
        <section class="challenge-prompt hidden" id="challenge-prompt">
            <div class="success-message">
                <h2>Great job! You completed the example!</h2>
                <p>Ready to design your own algorithm?</p>
                <a href="/challenge" class="btn-success btn-large">Try a Challenge!</a>
            </div>
        </section>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize simulator without onboarding - go straight to simulator
    const simulator = new TuringSimulator();
    simulator.skipOnboarding = true;
    simulator.init();
});
</script>
{% endblock %}
