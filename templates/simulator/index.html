{% extends "base.html" %}

{% block title %}Simulator :: TURING.MACHINE{% endblock %}

{% block content %}
<div class="simulator-page">
    <!-- Input Row -->
    <div class="input-row">
        <input type="text" id="tape-input" class="tape-input" placeholder="1011" value="1011">
        <button id="btn-set-tape" class="btn btn-set">SET</button>
    </div>

    <!-- Tape Section -->
    <section class="tape-section card">
        <div class="card-header">TAPE</div>
        <div class="tape-container">
            <div class="tape" id="tape">
                <!-- Tape cells render here dynamically with HEAD label -->
            </div>
        </div>
    </section>

    <!-- State Display -->
    <section class="state-section card">
        <div class="state-display">
            <span class="state-indicator" id="state-indicator"></span>
            <span class="state-label">Mode:</span>
            <span class="state-value" id="current-state">SCAN</span>
            <span class="state-emoji" id="state-emoji"></span>
            <span class="state-description" id="state-description"></span>
            <span id="status-badge" class="status-badge"></span>
        </div>
    </section>

    <!-- Controls -->
    <section class="controls-section card">
        <div class="controls-container">
            <div class="controls-group">
                <button id="btn-step" class="btn btn-secondary">
                    <span class="btn-icon">|&gt;</span> STEP
                </button>
                <button id="btn-run" class="btn btn-primary">
                    <span class="btn-icon">&#9654;</span> RUN
                </button>
                <button id="btn-pause" class="btn btn-outline" disabled>
                    PAUSE
                </button>
                <button id="btn-reset" class="btn btn-danger">
                    <span class="btn-icon">&#8635;</span> RESET
                </button>
            </div>
            <div class="speed-control">
                <span class="speed-label">SPD</span>
                <input type="range" id="speed-slider" class="speed-slider" min="1" max="100" value="50">
                <span class="speed-value" id="speed-value">5x</span>
            </div>
        </div>
    </section>

    <!-- Rules Section - no wrapper card, tables have their own headers like original -->
    <section class="rules-section">
        <div class="rules-grid" id="rules-cards">
            <!-- Dynamic state cards render here -->
        </div>
    </section>

    <!-- Algorithm Footer -->
    <div class="algo-footer">
        BINARY INCREMENT ALGORITHM &bull; ALAN TURING, 1936
    </div>

    <!-- Hidden elements for JS compatibility -->
    <div id="rules-list-scan" class="hidden"></div>
    <div id="rules-list-add" class="hidden"></div>
    <div id="history-log" class="hidden"></div>
    <div id="simulator-graph" class="hidden"></div>
    <div class="goal-display hidden" id="goal-display"></div>

    <!-- Hidden next action box -->
    <div id="next-action-box" class="hidden">
        <span id="next-state"></span>
        <span id="next-symbol"></span>
        <span id="next-action-text"></span>
        <span id="next-action-why"></span>
    </div>

    <section class="challenge-prompt hidden" id="challenge-prompt">
        <div class="card">
            <div class="card-body text-center">
                <h2 class="text-green">Computation Complete!</h2>
                <p class="text-muted mt-2">Ready for a challenge?</p>
                <a href="/challenge" class="btn btn-primary mt-3">Try Challenge Mode</a>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const simulator = new TuringSimulator();
    simulator.skipOnboarding = true;
    simulator.init();

    // Speed slider display
    const speedSlider = document.getElementById('speed-slider');
    const speedValue = document.getElementById('speed-value');
    if (speedSlider && speedValue) {
        speedSlider.addEventListener('input', function() {
            const val = Math.round(this.value / 10);
            speedValue.textContent = val + 'x';
        });
    }
});
</script>
{% endblock %}
